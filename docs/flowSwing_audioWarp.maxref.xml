<?xml version='1.0' encoding='utf-8' standalone='no'?>
<?xml-stylesheet href="./_c74_ref.xsl" type="text/xsl"?>
<!--
Part of the FlowSwing package
See license.md file in the project root for full license information.
-->
<c74object name='flowSwing.audioWarp' category='FlowSwing'>
	<digest>NI Grid based time-warp of sound samples</digest>
	<description>Generates complex time-warp that can be modulated in real time.</description>
	<discussion>
		<h4>
			<openfilelink filename="FlowSwing_overview.maxpat">FlowSwing Overview</openfilelink>
		</h4>
		FlowSwing is based on Non-Isochronous (NI) Grids. It time-warps sound samples through flexible, dynamic timing structures that go beyond traditional meter.
		At its core, FlowSwing uses a small number of parameters to define grids generated by morphing between two isochronous pulses. These Non-Isochronous Grids are made of two beat durations (Short and Long), distributed as evenly as possible over a cycle, that can be dynamically modulated during performance.
		<p>
			<o>flowSwing.audioWarp</o> is part of the FlowSwing package.
		</p>
	</discussion>
	<!--METADATA-->
	<metadatalist>
		<metadata name='author'>George Sioros</metadata>
		<metadata name='tag'>FlowSwing</metadata>
		<metadata name='tag'>Flow</metadata>
		<metadata name='tag'>Swing</metadata>
	</metadatalist>
	<!--INLETS-->
	<inletlist>
		<inlet id="0" type="signal">
			<digest>
				Playback position
			</digest>
			<description>
			</description>
		</inlet>
	</inletlist>
	<!--OUTLETS-->
	<outletlist>
		<outlet id="0" type="signal">
			<digest>
				Time-warped audio signal
			</digest>
			<description>
			</description>
		</outlet>
	</outletlist>
	<!--ARGUMENTS-->
	<objarglist>
	</objarglist>
	<!--MESSAGES-->
	<methodlist>
		<method name="Formative">
			<arglist>
				<arg name="number of beats" optional="0" type="int"/>
			</arglist>
			<digest>
				In right inlet: Sets the number of beats of the Formative pulse
			</digest>
			<description>

			</description>
		</method>
		<method name="Target">
			<arglist>
				<arg name="number of beats" optional="0" type="int" />
			</arglist>
			<digest>
				In right inlet: Sets the number of beats of the Target pulse
			</digest>
			<description>

			</description>
		</method>
		<method name="S">
			<arglist>
				<arg name="value of NI Grid parameter S" optional="0" type="float" />
			</arglist>
			<digest>
			</digest>
			<description>
				<p>In right inlet: Controls the position of the NI Grid beats. </p>
				<p>
					For S = 0 the NI Grid beats align with the Formative pulse, for S = 1 they align with the Target pulse. Values in between will produce beat positions that are a linear interpolation between the Formative and Target pulses.
				</p>
			</description>
		</method>
		<method name="asGrid">
			<arglist>
				<arg name="values of S, rotation (R) and Target pulse of the NI Grid when locked" optional="0" type="list" />
			</arglist>
			<digest>
			</digest>
			<description>
				<p>In right inlet: Determines the NI beat with which each marker is associated</p>
				<p>
					When a pattern is locked, each marker's position (desstime) is associated with the nearest NI beat. As the location of the NI beats is determined by the values of S, rotation (R) and Target pulse, these are stored internaly so that they associations can be recreated. This message sets these values.
				</p>
			</description>
		</method>
		<method name="lock">
			<arglist>
				<arg name="Lock state of pattern" optional="0" type="int" />
			</arglist>
			<digest>
			</digest>
			<description>
				<p>In right inlet: Sets the lock state of the patter</p>
				<p>
					When a pattern is locked the markers are associated with the nearest NI beats, which are determined by the values of S, rotation (R), Formative and Target pulses. The markers are set before locking, but they are only associated with the NI beats when the pattern is locked. 
				</p>
			</description>
		</method>	
		<method name="markers">
			<arglist>
				<arg name="User defined warp markers" optional="0" type="dict" />
			</arglist>
			<digest>
			</digest>
			<description>
				<p>In right inlet: Sets the marker positions (before locked)</p>
				<p>
					The dictionary must include a <m>markers</m> key containing nested dictionaries, each representing a marker. Each marker dictionary must have two keys: <m>sourcetime</m> and <m>desttime</m>. The <m>sourcetime</m> defines the marker’s position relative to the original sound buffer, while <m>desttime</m> defines its position in the warped playback timeline. If these two values differ, an initial user-defined time-warp is applied. Pattern locking affects only the <m>desttime</m> values and leaves the <m>sourcetime</m> unchanged.
				</p>
			</description>
		</method>

		<method name="morph">
			<arglist>
				<arg name="Morph value" optional="0" type="float" />
			</arglist>
			<digest>
			</digest>
			<description>
				<p>In right inlet: Sets the relative degree that each marker is shifted towards its associated NI Grid beat </p>
				<p>
					When a pattern is locked, each marker is associated with a nearby NI Grid beat. At <m>morph = 0</m>, markers stay at their user defined locations. As <m>morph</m> increases toward 1, markers smoothly slide toward their corresponding NI beats. At <m>morph = 1</m>, each marker fully snaps to its assigned beat. Intermediate values create a gradual visual morphing between the user defined pattern and the NI Grid.
				</p>
				<p>
					If multiple markers are associated with the same NI beat, the closest one moves directly to that beat, while the others stretch proportionally between the surrounding beats. To force all markers to align exactly with the NI Grid, set <m>morph</m> to 1.1.
				</p>

			</description>
		</method>
		<method name="mute">
			<arglist>
				<arg name="Mute state" optional="0" type="int" />
			</arglist>
			<digest>
			</digest>
			<description>
				<p>In right inlet: Sets the mute state</p>
				<p>
					When a FlowSwing is muted all signal outputs are zero. 
				</p>
			</description>
		</method>
		<method name="niRotation">
			<arglist>
				<arg name="Rotation (R) configuration" optional="0" type="int" />
			</arglist>
			<digest>
			</digest>
			<description>
				<p>In right inlet: Sets the rotation configuration of the NI Grid</p>
				<p>
					NI Grids are generated by shifting each beat of the Formative pulse toward either the preceding or following beat of the Target pulse. This process yields two distinct interval durations—Long and Short—which are distributed as evenly as possible across the repetition cycle.
					For example, an NI Grid with <m>F = 3</m> and <m>T = 7</m> produces one Long and two Short durations in a <m>Long-Short-Short</m> pattern. The specific rotation of this pattern depends on the shift configuration—i.e., which Formative beats are moved forward or backward toward the Target beats.
				</p>

			</description>
		</method>
		<method name="offset">
			<arglist>
				<arg name="Offset value" optional="0" type="float" />
			</arglist>
			<digest>
			</digest>
			<description>
				<p>
					In right inlet: Sets a phase offset (0–1) for the playback start position within the repetition cycle. Affects how playback aligns with other processes.
				</p>

			</description>
		</method>
		<method name="snapToNIGrid">
			<arglist>
				<arg name="SnapToNIGrid state" optional="0" type="int" />
			</arglist>
			<digest>
			</digest>
			<description>
				<p>
					In right inlet: Sets the SnapToNIGrid. When snapToGrid is on (1), markers are locked to the nearest NI Grid beat. When snapToGrid is off (0), markers are locked to the nearest Formative beat. The default is On.
				</p>
			</description>
		</method>
		<method name="title">
			<arglist>
				<arg name="title" optional="0" type="symbol" />
			</arglist>
			<digest>
			</digest>
			<description>
				<p>
					In right inlet: Sets the string that appears at the top left corner of the FlowSwing interface.
				</p>
			</description>
		</method>
		<method name="zoom">
			<arglist>
				<arg name="zoom" optional="0" type="float" />
			</arglist>
			<digest>
			</digest>
			<description>
				<p>
					In right inlet: The message zoom followed by a positive float value sets the zoom factor of the individual FlowSwing instance. Note that it is overwritten when the parent's zoom factor is set. 
				</p>
			</description>
		</method>
		<method name="patcher">
			<arglist>
				<arg name="patcher" optional="0" type="anything" />
			</arglist>
			<digest>
			</digest>
			<description>
				<p>
					In right inlet: The message pacther can be set to send messages to thispatcher of the FlowSwing instance. It can be used to set a bpatcher offset.
				</p>
			</description>
		</method>
		<method name="signal">
			<arglist>
			</arglist>
			<digest>
			</digest>
			<description>
				<p>
					In left inlet: The phase input signal is used to determine the playback position. It is typically  generated by a <m>phasor</m>.
				</p>
			</description>
		</method>
	</methodlist>
	<!--ATTRIBUTES-->
	<attributelist>

	</attributelist>
	<!--SEEALSO-->
	<seealsolist>
		<seealso name='flowSwing_envelop' />
		<seealso name="flowSwing_nested" />
		<seealso name='flowSwing_noise' />
	</seealsolist>
	<!--INLETS/OUTLETS-->
	<misc name="Inlets">
		<entry name="Left">
			<digest>
				Playback position
			</digest>
			<description>
				<p>
					The phase input signal takes values between 0 and 1 and is used to determine the playback position. It is typically generated by a <m>phasor</m>.
				</p>
			</description>
		</entry>
		<entry name="Right">
			<digest>
				Messages to set and get parameters through the pattr system, and messages to thispatcher. 
			</digest>
			<description>
			</description>
		</entry>
	</misc>
	<misc name="Output">
		<entry name="signal">
			<description>
				<p>Out left outlet: time-warped audio signal.</p>
			</description>
		</entry>
		<entry name="anything">
			<description>
				<p>
					Out right outlet: Parameter changes made via the UI or by recalling a preset are sent to the right outlet. Changes received through the right inlet are not forwarded, to prevent feedback loops when two FlowSwing instances mirror each other's state.
				</p>
			</description>
		</entry>
	</misc>
</c74object>